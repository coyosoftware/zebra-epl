# encoding: utf-8
require 'spec_helper'

describe Zebra::Epl::Image do
  it "can be initialized with the position of the image to be printed" do
    image = described_class.new position: [20, 40]
    image.position.should == [20,40]
    image.x.should == 20
    image.y.should == 40
  end

  it "can be initialized with the data to be printed" do
    data = "foobar"
    text = described_class.new data: data
    text.data.should == data
  end

  describe "#to_epl" do
    subject(:image) { described_class.new position: [100, 150], data: File.open(File.join(Dir.pwd, 'spec', 'support', 'biohazard.pcx')) }
    let(:tokens) { image.to_epl.split(",") }

    it "raises an error if the X position was not informed" do
      image = described_class.new position: [nil, 100], data: "foobar"
      expect {
        image.to_epl
      }.to raise_error(Zebra::Epl::Printable::MissingAttributeError, "Can't print if the X value is not given")
    end

    it "raises an error if the Y position was not informed" do
      image = described_class.new position: [100, nil]
      expect {
        image.to_epl
      }.to raise_error(Zebra::Epl::Printable::MissingAttributeError, "Can't print if the Y value is not given")
    end

    it "raises an error if the data to be printed was not informed" do
      image.data = nil
      expect {
        image.to_epl
      }.to raise_error(Zebra::Epl::Printable::MissingAttributeError, "Can't print if the data to be printed is not given")
    end

    it 'raises an error if the data is not a file' do
      image.data = 'foobar'
      expect {
        image.to_epl
      }.to raise_error(Zebra::Epl::Printable::MissingAttributeError, "Can't print if the data to be printed is not a file")
    end

    it 'raises an error if the data is not a PCX image' do
      image.data = Tempfile.new('foo.png')
      expect {
        image.to_epl
      }.to raise_error(Zebra::Epl::Printable::MissingAttributeError, "Can't print if the data to be printed is not a PCX image")
    end

    it "begins with the 'GW' command" do
      image.to_epl.should =~ /\AGW/
    end

    it "contains the X position" do
      tokens[0].match(/(\d+)/)[1].should eq "100"
    end

    it "contains the Y position" do
      tokens[1].should eq "150"
    end

    it "contains the image width" do
      tokens[2].should eq "15"
    end

    it "contains the image length" do
      tokens[3].should eq "120"
    end

    it "contains the image data" do
      tokens[4].bytes.should eq [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 248, 126, 31, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 224, 255, 7, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 7, 255, 224, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 252, 31, 255, 248, 63, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 248, 63, 255, 252, 31, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 240, 255, 255, 255, 15, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 193, 255, 255, 255, 131, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 193, 255, 255, 255, 131, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 131, 255, 255, 255, 193, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 7, 255, 255, 255, 224, 255, 255, 255, 255, 255, 255, 255, 255, 255, 254, 15, 255, 255, 255, 240, 127, 255, 255, 255, 255, 255, 255, 255, 255, 254, 15, 255, 255, 255, 240, 127, 255, 255, 255, 255, 255, 255, 255, 255, 252, 15, 255, 255, 255, 240, 63, 255, 255, 255, 255, 255, 255, 255, 255, 252, 31, 255, 255, 255, 248, 63, 255, 255, 255, 255, 255, 255, 255, 255, 248, 31, 255, 255, 255, 248, 31, 255, 255, 255, 255, 255, 255, 255, 255, 248, 31, 255, 255, 255, 248, 31, 255, 255, 255, 255, 255, 255, 255, 255, 248, 63, 255, 255, 255, 248, 31, 255, 255, 255, 255, 255, 255, 255, 255, 240, 63, 255, 255, 255, 252, 15, 255, 255, 255, 255, 255, 255, 255, 255, 240, 63, 255, 255, 255, 252, 15, 255, 255, 255, 255, 255, 255, 255, 255, 240, 63, 255, 255, 255, 252, 15, 255, 255, 255, 255, 255, 255, 255, 255, 240, 63, 255, 255, 255, 252, 15, 255, 255, 255, 255, 255, 255, 255, 255, 240, 31, 255, 255, 255, 248, 15, 255, 255, 255, 255, 255, 255, 255, 255, 240, 31, 255, 195, 255, 248, 15, 255, 255, 255, 255, 255, 255, 255, 255, 240, 31, 248, 0, 31, 248, 15, 255, 255, 255, 255, 255, 255, 255, 255, 240, 31, 224, 0, 3, 248, 15, 255, 255, 255, 255, 255, 255, 255, 255, 240, 15, 0, 0, 0, 240, 15, 255, 255, 255, 255, 255, 255, 255, 255, 240, 14, 0, 0, 0, 112, 15, 255, 255, 255, 255, 255, 255, 255, 255, 240, 6, 0, 0, 0, 96, 15, 255, 255, 255, 255, 255, 255, 255, 255, 240, 7, 1, 255, 128, 224, 15, 255, 255, 255, 255, 255, 255, 255, 255, 240, 3, 135, 255, 225, 192, 15, 255, 255, 255, 255, 255, 255, 255, 255, 248, 1, 223, 255, 251, 128, 31, 255, 255, 255, 255, 255, 255, 255, 255, 248, 0, 255, 255, 255, 0, 31, 255, 255, 255, 255, 255, 255, 255, 255, 252, 0, 127, 255, 254, 0, 63, 255, 255, 255, 255, 255, 255, 255, 255, 224, 0, 63, 255, 252, 0, 7, 255, 255, 255, 255, 255, 255, 255, 254, 0, 0, 15, 255, 240, 0, 0, 127, 255, 255, 255, 255, 255, 255, 248, 0, 0, 7, 255, 224, 0, 0, 31, 255, 255, 255, 255, 255, 255, 224, 0, 0, 0, 126, 0, 0, 0, 7, 255, 255, 255, 255, 255, 255, 192, 0, 0, 0, 24, 0, 0, 0, 3, 255, 255, 255, 255, 255, 255, 128, 0, 0, 0, 24, 0, 0, 0, 1, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 24, 0, 0, 0, 0, 255, 255, 255, 255, 255, 254, 0, 0, 0, 0, 60, 0, 0, 0, 0, 127, 255, 255, 255, 255, 252, 0, 0, 0, 0, 255, 0, 0, 0, 0, 63, 255, 255, 255, 255, 248, 1, 255, 192, 1, 255, 128, 3, 255, 128, 31, 255, 255, 255, 255, 240, 7, 255, 248, 1, 255, 128, 31, 255, 224, 15, 255, 255, 255, 255, 240, 31, 248, 62, 3, 255, 192, 124, 31, 248, 15, 255, 255, 255, 255, 224, 63, 248, 63, 3, 255, 192, 252, 31, 252, 7, 255, 255, 255, 255, 224, 127, 248, 63, 131, 255, 193, 252, 31, 254, 7, 255, 255, 255, 255, 193, 255, 248, 63, 195, 255, 195, 252, 31, 255, 131, 255, 255, 255, 255, 193, 255, 248, 63, 227, 255, 199, 252, 31, 255, 131, 255, 255, 255, 255, 131, 255, 248, 63, 255, 255, 255, 252, 31, 255, 193, 255, 255, 255, 255, 135, 255, 248, 31, 252, 126, 63, 248, 31, 255, 225, 255, 255, 255, 255, 135, 255, 248, 31, 248, 24, 31, 248, 31, 255, 225, 255, 255, 255, 255, 143, 255, 252, 31, 248, 0, 31, 248, 63, 255, 241, 255, 255, 255, 255, 143, 255, 252, 15, 252, 0, 63, 240, 63, 255, 241, 255, 255, 255, 255, 143, 255, 252, 15, 252, 0, 63, 240, 63, 255, 241, 255, 255, 255, 255, 31, 255, 254, 7, 252, 0, 63, 224, 127, 255, 248, 255, 255, 255, 255, 31, 255, 254, 7, 252, 0, 63, 224, 127, 255, 248, 255, 255, 255, 255, 159, 255, 255, 3, 254, 0, 63, 192, 255, 255, 249, 255, 255, 255, 255, 159, 255, 255, 1, 252, 0, 127, 128, 255, 255, 249, 255, 255, 255, 255, 159, 255, 255, 128, 252, 0, 63, 1, 255, 255, 249, 255, 255, 255, 255, 159, 255, 255, 192, 60, 0, 60, 3, 255, 255, 249, 255, 255, 255, 255, 159, 255, 255, 192, 12, 0, 48, 7, 255, 255, 249, 255, 255, 255, 255, 159, 255, 255, 240, 12, 0, 48, 15, 255, 255, 249, 255, 255, 255, 255, 223, 255, 255, 248, 12, 0, 48, 31, 255, 255, 251, 255, 255, 255, 255, 223, 255, 255, 252, 24, 0, 24, 63, 255, 255, 251, 255, 255, 255, 255, 207, 255, 255, 254, 24, 0, 24, 127, 255, 255, 243, 255, 255, 255, 255, 255, 255, 255, 255, 152, 0, 25, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 240, 0, 15, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 240, 0, 15, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 224, 0, 7, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 192, 0, 3, 255, 255, 255, 255, 255, 255, 255, 255, 253, 255, 255, 255, 192, 0, 3, 255, 255, 255, 191, 255, 255, 255, 255, 254, 255, 255, 255, 0, 24, 0, 255, 255, 255, 127, 255, 255, 255, 255, 254, 63, 255, 254, 0, 60, 0, 127, 255, 252, 127, 255, 255, 255, 255, 255, 31, 255, 252, 0, 126, 0, 63, 255, 248, 255, 255, 255, 255, 255, 255, 135, 255, 240, 0, 255, 0, 15, 255, 225, 255, 255, 255, 255, 255, 255, 224, 127, 128, 1, 255, 128, 1, 254, 7, 255, 255, 255, 255, 255, 255, 240, 0, 0, 3, 255, 192, 0, 0, 15, 255, 255, 255, 255, 255, 255, 252, 0, 0, 15, 255, 240, 0, 0, 63, 255, 255, 255, 255, 255, 255, 255, 0, 0, 63, 255, 252, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 192, 1, 255, 255, 255, 128, 3, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 254, 1, 195, 129, 195, 14, 15, 0, 224, 240, 14, 1, 255, 255, 255, 254, 0, 195, 0, 195, 14, 15, 0, 224, 112, 6, 0, 255, 255, 255, 254, 0, 66, 24, 195, 14, 7, 0, 224, 112, 6, 0, 255, 255, 255, 254, 24, 66, 24, 67, 14, 7, 240, 224, 112, 194, 24, 127, 255, 255, 254, 24, 66, 24, 67, 12, 71, 225, 192, 112, 194, 24, 127, 255, 255, 254, 0, 194, 24, 64, 12, 71, 225, 196, 48, 198, 24, 127, 255, 255, 254, 1, 194, 24, 64, 12, 67, 195, 196, 48, 6, 24, 127, 255, 255, 254, 0, 194, 24, 64, 12, 99, 195, 198, 48, 6, 24, 127, 255, 255, 254, 24, 66, 24, 67, 8, 99, 135, 198, 48, 134, 24, 127, 255, 255, 254, 24, 66, 24, 67, 8, 3, 143, 128, 48, 194, 24, 127, 255, 255, 254, 24, 66, 24, 67, 8, 1, 15, 128, 16, 194, 24, 127, 255, 255, 254, 0, 66, 16, 195, 8, 1, 0, 128, 16, 194, 0, 255, 255, 255, 254, 0, 195, 0, 195, 0, 225, 0, 142, 16, 198, 0, 255, 255, 255, 254, 1, 195, 129, 195, 0, 225, 0, 15, 0, 194, 1, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]
    end
  end
end
